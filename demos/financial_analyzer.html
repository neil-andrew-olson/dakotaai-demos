<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="AI Financial Document Analyzer - Automated Analysis & Risk Assessment">
    <title>Financial Document Analyzer - Dakota AI Demo</title>
    <link rel="stylesheet" href="../css/style.css">
    <link rel="icon" href="../DA.png">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        .financial-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 2rem;
        }

        .financial-header {
            text-align: center;
            margin-bottom: 3rem;
            background: linear-gradient(135deg, #1e40af 0%, #3b82f6 100%);
            color: white;
            padding: 3rem;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .roi-banner {
            background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);
            color: #1f2937;
            padding: 1.5rem;
            border-radius: 10px;
            margin-bottom: 2rem;
            text-align: center;
            font-weight: bold;
            font-size: 1.2rem;
        }

        .upload-zone {
            background: white;
            padding: 3rem;
            border-radius: 15px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            border: 2px dashed #d1d5db;
            text-align: center;
            margin-bottom: 2rem;
            transition: all 0.3s ease;
        }

        .upload-zone:hover {
            border-color: #3b82f6;
            background: #eff6ff;
        }

        .upload-icon {
            font-size: 4rem;
            color: #6b7280;
            margin-bottom: 1rem;
        }

        .processing-status {
            background: white;
            padding: 2rem;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            margin-bottom: 2rem;
            display: none;
        }

        .progress-bar {
            width: 100%;
            height: 24px;
            background: #e5e7eb;
            border-radius: 12px;
            overflow: hidden;
            margin: 1rem 0;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #10b981, #3b82f6);
            width: 0%;
            transition: width 0.5s ease;
            border-radius: 12px;
        }

        .analysis-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 2rem;
            margin-bottom: 2rem;
        }

        .analysis-card {
            background: white;
            padding: 2rem;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            border-top: 4px solid #3b82f6;
        }

        .metric-display {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem;
            background: #f8fafc;
            border-radius: 8px;
            margin-bottom: 1rem;
        }

        .metric-value {
            font-size: 1.5rem;
            font-weight: bold;
            color: #3b82f6;
        }

        .risk-level {
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-weight: bold;
            font-size: 0.9rem;
        }

        .risk-high { background: #fee2e2; color: #dc2626; }
        .risk-medium { background: #fef3c7; color: #d97706; }
        .risk-low { background: #d1fae5; color: #059669; }

        .summary-section {
            background: white;
            padding: 2rem;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            margin-bottom: 2rem;
        }

        .action-buttons {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
            margin-top: 2rem;
        }

        .btn-primary, .btn-secondary {
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-primary {
            background: linear-gradient(135deg, #3b82f6, #1d4ed8);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(59, 130, 246, 0.3);
        }

        .btn-secondary {
            background: #6b7280;
            color: white;
        }

        .btn-secondary:hover {
            background: #4b5563;
        }

        .loading-spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f4f6;
            border-radius: 50%;
            border-top-color: #3b82f6;
            animation: spin 1s ease-in-out infinite;
            margin-right: 0.5rem;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .error-message {
            background: #fee2e2;
            border: 1px solid #fca5a5;
            color: #dc2626;
            padding: 1rem;
            border-radius: 8px;
            display: none;
            margin-top: 1rem;
        }

        @media (max-width: 768px) {
            .analysis-grid {
                grid-template-columns: 1fr;
            }

            .action-buttons {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <main class="financial-container">
        <!-- Header Section -->
        <div class="financial-header">
            <h1><i class="fas fa-chart-line"></i> AI Financial Document Analyzer</h1>
            <p>Transform hours of manual document review into minutes of AI-powered analysis</p>
            <div class="roi-banner">
                ðŸš€ <strong>$2.5M Annual Savings</strong> - Automate financial document analysis and risk assessment
            </div>
        </div>

        <!-- Upload Zone -->
        <div class="upload-zone" id="uploadZone">
            <div class="upload-icon">
                <i class="fas fa-file-contract"></i>
            </div>
            <h3>Upload Financial Documents</h3>
            <p>Drop financial statements, contracts, or regulatory filings here</p>
            <p><small>Supports PDF, Word, Excel, and TXT files up to 10MB</small></p>
            <input type="file" id="documentInput" accept=".pdf,.doc,.docx,.xls,.xlsx,.txt" multiple style="display: none;">
        </div>

        <!-- Processing Status -->
        <div class="processing-status" id="processingStatus">
            <h3><i class="fas fa-cogs"></i> Analyzing Documents...</h3>
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill"></div>
            </div>
            <p id="progressText">Initializing AI analysis...</p>
        </div>

        <!-- Error Message -->
        <div class="error-message" id="errorMessage">
            <i class="fas fa-exclamation-triangle"></i>
            <span id="errorText"></span>
        </div>

        <!-- Analysis Results -->
        <div class="analysis-grid" id="analysisResults" style="display: none;">
            <!-- Key Metrics -->
            <div class="analysis-card">
                <h3><i class="fas fa-chart-pie"></i> Key Financial Metrics</h3>
                <div class="metric-display">
                    <span><i class="fas fa-dollar-sign"></i> Revenue</span>
                    <span class="metric-value" id="revenueValue">$0</span>
                </div>
                <div class="metric-display">
                    <span><i class="fas fa-chart-line"></i> Profit Margin</span>
                    <span class="metric-value" id="profitMargin">0%</span>
                </div>
                <div class="metric-display">
                    <span><i class="fas fa-balance-scale"></i> Debt Ratio</span>
                    <span class="metric-value" id="debtRatio">0%</span>
                </div>
            </div>

            <!-- Risk Assessment -->
            <div class="analysis-card">
                <h3><i class="fas fa-shield-alt"></i> Risk Assessment</h3>
                <div class="metric-display">
                    <span><i class="fas fa-exclamation-triangle"></i> Overall Risk</span>
                    <span class="risk-level" id="overallRisk">Calculating...</span>
                </div>
                <div class="metric-display">
                    <span><i class="fas fa-clipboard-check"></i> Compliance Status</span>
                    <span class="risk-level risk-low" id="complianceStatus">Checking...</span>
                </div>
                <div class="metric-display">
                    <span><i class="fas fa-flag"></i> Issues Found</span>
                    <span class="metric-value" id="issuesCount">0</span>
                </div>
            </div>

            <!-- Document Classification -->
            <div class="analysis-card">
                <h3><i class="fas fa-tags"></i> Document Classification</h3>
                <div id="documentType">
                    <p>Analyzing document type...</p>
                </div>
            </div>
        </div>

        <!-- Summary Section -->
        <div class="summary-section" id="summarySection" style="display: none;">
            <h3><i class="fas fa-file-alt"></i> Analysis Summary</h3>
            <div id="documentSummary">
                <p>Generating executive summary...</p>
            </div>

            <div class="action-buttons">
                <button class="btn-primary" id="exportReport">
                    <i class="fas fa-download"></i> Export Report
                </button>
                <button class="btn-primary" id="askQuestions">
                    <i class="fas fa-question-circle"></i> Ask Questions
                </button>
                <button class="btn-secondary" id="compareDocuments">
                    <i class="fas fa-balance-scale"></i> Compare Documents
                </button>
            </div>
        </div>

        <!-- Document Preview (if applicable) -->
        <div id="documentPreview" style="display: none;">
            <!-- Document content would be displayed here -->
        </div>
    </main>

    <script>
        // Sample financial document data for demo
        const sampleFinancialData = {
            companyMetrics: {
                name: "TechCorp Inc.",
                period: "Q4 2024",
                revenue: "$45,200,000",
                profit: "$8,950,000",
                assets: "$120,500,000",
                liabilities: "$45,300,000",
                cashFlow: "$12,450,000",
                debtToEquity: 1.25,
                profitMargin: 19.8,
                growthRate: 12.5
            },
            quarterlyTrends: [
                { quarter: 'Q1 2024', revenue: 38500000, profit: 7450000, expenses: 31050000 },
                { quarter: 'Q2 2024', revenue: 41200000, profit: 8120000, expenses: 33080000 },
                { quarter: 'Q3 2024', revenue: 42900000, profit: 8540000, expenses: 34360000 },
                { quarter: 'Q4 2024', revenue: 45200000, profit: 8950000, expenses: 36250000 }
            ],
            expenseBreakdown: [
                { category: 'Operations', amount: 18950000, percentage: 41.9 },
                { category: 'R&D', amount: 8950000, percentage: 19.8 },
                { category: 'Marketing', amount: 5230000, percentage: 11.6 },
                { category: 'Administration', amount: 6980000, percentage: 15.4 },
                { category: 'Other', amount: 5100000, percentage: 11.3 }
            ],
            riskAnalysis: {
                overallRisk: "Low",
                complianceStatus: "Good Standing",
                redFlags: 2,
                opportunities: 5,
                industryComparison: {
                    revenueGrowth: "Above Average (+12.5%)",
                    profitMargin: "Industry Leader (19.8%)",
                    debtLevel: "Conservative (1.25 ratio)"
                }
            },
            keyInsights: [
                "Revenue growth accelerated in Q4 to 12.5%, driven by new product launches",
                "Profit margins remain strong at 19.8%, outperforming industry average by 4.2%",
                "Cash flow generation improved significantly, providing strong liquidity position",
                "R&D investment increased 15% YoY, positioning for future growth",
                "Debt-to-equity ratio of 1.25 remains conservative and well below industry norms"
            ],
            recommendations: [
                "Continue R&D investment strategy - strong ROI demonstrated",
                "Expand marketing in emerging markets to capitalize on brand strength",
                "Monitor supply chain costs amid inflationary pressures",
                "Consider share buyback program given strong cash position",
                "Accelerate international expansion to leverage competitive advantages"
            ]
        };

        // Available Hugging Face models for financial analysis
        const MODELS = {
            classification: 'facebook/bart-large-mnli',
            ner: 'dbmdz/bert-large-cased-finetuned-conll03-english',
            summarization: 'facebook/bart-large-cnn',
            qa: 'deepset/roberta-base-squad2'
        };

        // Global variables
        let uploadedFiles = [];
        let analysisResults = {};

        // DOM elements
        const uploadZone = document.getElementById('uploadZone');
        const documentInput = document.getElementById('documentInput');
        const processingStatus = document.getElementById('processingStatus');
        const errorMessage = document.getElementById('errorMessage');
        const analysisResultsDiv = document.getElementById('analysisResults');
        const summarySection = document.getElementById('summarySection');
        const progressFill = document.getElementById('progressFill');
        const progressText = document.getElementById('progressText');

        // Initialize the application
        document.addEventListener('DOMContentLoaded', () => {
            initializeUploadHandlers();
            hideError();
        });

        function initializeUploadHandlers() {
            // Click to upload
            uploadZone.addEventListener('click', () => documentInput.click());

            // File selection
            documentInput.addEventListener('change', handleFileSelection);

            // Drag and drop
            ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
                uploadZone.addEventListener(eventName, preventDefaults, false);
            });

            function preventDefaults(e) {
                e.preventDefault();
                e.stopPropagation();
            }

            ['dragenter', 'dragover'].forEach(eventName => {
                uploadZone.addEventListener(eventName, highlight, false);
            });

            ['dragleave', 'drop'].forEach(eventName => {
                uploadZone.addEventListener(eventName, unhighlight, false);
            });

            function highlight(e) {
                uploadZone.classList.add('highlight');
            }

            function unhighlight(e) {
                uploadZone.classList.remove('highlight');
            }

            uploadZone.addEventListener('drop', handleDrop, false);

            function handleDrop(e) {
                const dt = e.dataTransfer;
                const files = dt.files;
                handleFiles(files);
            }
        }

        function handleFileSelection(e) {
            handleFiles(e.target.files);
        }

        function handleFiles(files) {
            // Always show sample results instead of processing uploaded files
            startAnalysis();
        }

        function startAnalysis() {
            // Show processing status
            processingStatus.style.display = 'block';
            uploadZone.style.display = 'none';
            hideError();

            // Start analysis process
            updateProgress(0, 'Extracting text from documents...');
            analyzeDocuments();
        }

        async function analyzeDocuments() {
            try {
                updateProgress(25, 'Processing uploaded documents...');
                await new Promise(resolve => setTimeout(resolve, 500));

                updateProgress(50, 'Extracting financial data and metrics...');
                await new Promise(resolve => setTimeout(resolve, 500));

                updateProgress(75, 'Running AI risk assessment algorithms...');
                await new Promise(resolve => setTimeout(resolve, 500));

                updateProgress(100, 'Analysis complete! Loading dashboard...');

                // Hide processing, show results
                setTimeout(() => {
                    processingStatus.style.display = 'none';
                    displaySampleResults();
                }, 800);

            } catch (error) {
                console.error('Analysis failed:', error);
                showError('Analysis failed: ' + error.message);
                processingStatus.style.display = 'none';
                uploadZone.style.display = 'block';
            }
        }

        async function extractTextFromFile(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();

                reader.onload = function(e) {
                    // For demo purposes, return mock text
                    // In production, you'd use PDF.js, mammoth.js, etc.
                    const mockText = `FINANCIAL STATEMENT ANALYSIS

Company: Sample Corporation
Period: Q4 2024

Revenue: $45,200,000
Net Profit: $8,950,000
Total Assets: $120,500,000
Total Liabilities: $45,300,000

Analysis: The company shows strong financial performance with 18.3% profit margin
and solid balance sheet ratios. Key risks include market volatility and
regulatory compliance requirements in the financial services sector.

Recommendations:
1. Increase cash reserves to 15% of total assets
2. Monitor debt-to-equity ratio quarterly
3. Implement enhanced compliance monitoring systems
4. Consider expansion into emerging markets with proper risk assessment`;

                    resolve(mockText);
                };

                reader.onerror = reject;
                reader.readAsArrayBuffer(file);
            });
        }

        async function callHuggingFaceAPI(model, inputs, task) {
            const response = await fetch(
                `https://api-inference.huggingface.co/models/${model}`,
                {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${HUGGING_FACE_API_TOKEN}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ inputs, parameters: { max_length: 100 } })
                }
            );

            if (!response.ok) {
                if (response.status === 503) {
                    throw new Error('AI model is loading. Please try again in a few seconds.');
                }
                const errorText = await response.text();
                throw new Error(`API Error: ${response.status} - ${errorText}`);
            }

            return await response.json();
        }

        async function classifyDocument(text) {
            const inputs = `Classify this financial document: ${text.substring(0, 512)}`;
            const result = await callHuggingFaceAPI(MODELS.classification, inputs, 'classification');

            // Mock classification for demo
            return {
                label: 'Financial Statement',
                confidence: 0.92,
                categories: ['10-K Filing', 'Balance Sheet', 'Income Statement', 'Cash Flow Statement']
            };
        }

        async function extractEntities(text) {
            const inputs = `Extract financial entities: ${text.substring(0, 512)}`;
            const result = await callHuggingFaceAPI(MODELS.ner, inputs, 'ner');

            // Mock entity extraction
            return {
                companies: ['Sample Corporation', 'ABC Financial'],
                amounts: ['$45.2M', '$8.95M', '$120.5M'],
                dates: ['Q4 2024', '2024'],
                ratios: ['18.3%', '15%']
            };
        }

        async function summarizeDocument(text) {
            const inputs = `Summarize this financial document: ${text}`;
            const result = await callHuggingFaceAPI(MODELS.summarization, inputs, 'summarization');

            // Mock summary for demo
            return "Sample Corporation demonstrates strong financial performance with $45.2M revenue and $8.95M net profit. The company maintains solid balance sheet ratios and implements risk management strategies. Key recommendations include increased cash reserves and enhanced compliance monitoring.";
        }

        function extractFinancialMetrics(text) {
            // Mock financial metrics extraction
            return {
                revenue: '$45,200,000',
                profit: '$8,950,000',
                assets: '$120,500,000',
                liabilities: '$45,300,000',
                profitMargin: '18.3%',
                debtRatio: '37.5%'
            };
        }

        function updateProgress(percentage, message) {
            progressFill.style.width = percentage + '%';
            progressText.textContent = message;
        }

        function displayResults() {
            analysisResultsDiv.style.display = 'grid';
            summarySection.style.display = 'block';

            // Update metrics
            const metrics = analysisResults.metrics;
            document.getElementById('revenueValue').textContent = metrics.revenue;
            document.getElementById('profitMargin').textContent = metrics.profitMargin;
            document.getElementById('debtRatio').textContent = metrics.debtRatio;

            // Update risk assessment
            document.getElementById('overallRisk').textContent = 'Low Risk';
            document.getElementById('overallRisk').className = 'risk-level risk-low';
            document.getElementById('complianceStatus').textContent = 'Compliant';

            // Update summary
            document.getElementById('documentSummary').innerHTML = `
                <h4>Executive Summary</h4>
                <p>${analysisResults.summary}</p>
                <h4>Key Findings</h4>
                <ul>
                    <li><strong>Revenue:</strong> ${metrics.revenue}</li>
                    <li><strong>Profit Margin:</strong> ${metrics.profitMargin}</li>
                    <li><strong>Risk Level:</strong> Low</li>
                    <li><strong>Compliance:</strong> Good standing</li>
                </ul>
            `;
        }

        function showError(message) {
            document.getElementById('errorText').textContent = message;
            errorMessage.style.display = 'block';
        }

        function hideError() {
            errorMessage.style.display = 'none';
        }

        // Export functionality (placeholder)
        document.getElementById('exportReport').addEventListener('click', () => {
            alert('Export functionality would generate a comprehensive PDF report with all analysis results.');
        });

        // Q&A functionality (placeholder)
        document.getElementById('askQuestions').addEventListener('click', () => {
            const question = prompt('Ask a question about the analyzed documents:');
            if (question) {
                alert('Q&A functionality would analyze the documents and provide specific answers to your questions.');
            }
        });

        // Document comparison (placeholder)
        document.getElementById('compareDocuments').addEventListener('click', () => {
            alert('Document comparison would allow side-by-side analysis of different financial documents.');
        });
    </script>
</body>
</html>
