<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dakota AI Demo: Statistical Distribution Explorer</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/mathjs@11.8.0"></script>
    <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            margin: 0;
            font-size: 2.5em;
            font-weight: 300;
        }

        .header p {
            margin: 10px 0 0 0;
            opacity: 0.9;
            font-size: 1.1em;
        }

        .nav-tabs {
            display: flex;
            background: #f8f9fa;
            border-bottom: 2px solid #dee2e6;
        }

        .nav-tabs button {
            flex: 1;
            padding: 12px 10px;
            border: none;
            background: none;
            cursor: pointer;
            font-size: 0.8em;
            font-weight: 500;
            color: #666;
            border-bottom: 3px solid transparent;
            transition: all 0.3s ease;
        }

        .nav-tabs button.active {
            color: #007bff;
            border-bottom-color: #007bff;
            background: white;
        }

        .nav-tabs button:hover:not(.active) {
            background: #e9ecef;
        }

        .tab-content {
            padding: 30px;
        }

        .tab-panel {
            display: none;
        }

        .tab-panel.active {
            display: block;
        }

        .distribution-selector {
            margin-bottom: 30px;
        }

        .distribution-selector select {
            padding: 12px 20px;
            font-size: 1.1em;
            border: 2px solid #ddd;
            border-radius: 8px;
            background: white;
            cursor: pointer;
            width: 100%;
            max-width: 300px;
        }

        .distribution-selector select:focus {
            outline: none;
            border-color: #007bff;
        }

        .content-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 30px;
        }

        .data-input-section {
            grid-column: span 2;
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            border: 1px solid #dee2e6;
            margin-bottom: 20px;
        }

        .data-input-controls {
            display: grid;
            grid-template-columns: 200px 1fr;
            gap: 20px;
            align-items: start;
        }

        .input-method-selector {
            max-width: 200px;
        }

        .params-panel {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 10px;
            border: 1px solid #dee2e6;
        }

        .params-panel h3 {
            margin-top: 0;
            color: #333;
            border-bottom: 2px solid #007bff;
            padding-bottom: 10px;
        }

        .param-control {
            margin-bottom: 20px;
        }

        .param-control label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: #555;
        }

        .param-control input {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 1em;
        }

        .param-control input:focus {
            outline: none;
            border-color: #007bff;
            box-shadow: 0 0 5px rgba(0,123,255,0.3);
        }

        .charts-panel {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        .chart-container {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .chart-container h4 {
            margin-top: 0;
            color: #333;
            text-align: center;
            margin-bottom: 15px;
        }

        canvas {
            width: 100% !important;
            height: 300px !important;
        }

        .stats-panel {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-top: 20px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
        }

        .stat-card {
            background: white;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        .stat-card .value {
            font-size: 1.5em;
            font-weight: bold;
            color: #007bff;
        }

        .stat-card .label {
            font-size: 0.9em;
            color: #666;
            margin-top: 5px;
        }

        .explanation-panel {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 10px;
            line-height: 1.6;
        }

        .explanation-panel h3 {
            margin-top: 0;
            color: #333;
        }

        .formula {
            background: white;
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid #007bff;
            margin: 15px 0;
            font-family: 'Courier New', monospace;
            font-size: 1.1em;
        }

        .applications {
            background: white;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
        }

        .applications ul {
            margin: 0;
            padding-left: 20px;
        }

        .applications li {
            margin-bottom: 5px;
        }

        @media (max-width: 768px) {
            .content-grid {
                grid-template-columns: 1fr;
            }

            .charts-panel {
                grid-template-columns: 1fr;
            }

            .nav-tabs button {
                padding: 10px 15px;
                font-size: 0.9em;
            }
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #666;
        }

        .error {
            background: #f8d7da;
            color: #721c24;
            padding: 15px;
            border-radius: 5px;
            margin: 10px 0;
            border: 1px solid #f5c6cb;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>🎲 Statistical Distribution Explorer</h1>
            <p>Interactive exploration of 22+ probability distributions with real-time visualizations and educational content</p>
        </div>

        <div class="nav-tabs">
            <button class="active" onclick="showTab('parameters')">Parameters</button>
            <button onclick="showTab('visualizations')">Visualizations</button>
            <button onclick="showTab('dataanalysis')">Data Analysis</button>
            <button onclick="showTab('explanations')">Theory</button>
        </div>

        <div class="tab-content">
            <div id="parameters" class="tab-panel active">
                <div class="distribution-selector">
                    <h3>Select a Distribution</h3>
                    <select id="distributionSelect" onchange="loadDistribution()">
                        <optgroup label="Continuous Distributions">
                            <option value="normal">Normal Distribution</option>
                            <option value="beta">Beta Distribution</option>
                            <option value="gamma">Gamma Distribution</option>
                            <option value="weibull">Weibull Distribution</option>
                            <option value="pareto">Pareto Distribution</option>
                            <option value="logistic">Logistic Distribution</option>
                            <option value="laplace">Laplace Distribution</option>
                            <option value="chisquared">Chi-Squared Distribution</option>
                            <option value="studentt">Student-t Distribution</option>
                            <option value="fdist">F-Distribution (Snedecor F)</option>
                            <option value="bivariate">Bivariate Normal Distribution</option>
                            <option value="lognormal">Log-Normal Distribution</option>
                        </optgroup>
                        <optgroup label="Discrete Distributions">
                            <option value="binomial">Binomial Distribution</option>
                            <option value="poisson">Poisson Distribution</option>
                            <option value="geometric">Geometric Distribution</option>
                            <option value="hypergeometric">Hypergeometric Distribution</option>
                            <option value="multivariate">Multivariate Hypergeometric</option>
                            <option value="negativebinomial">Negative Binomial Distribution</option>
                            <option value="multinomial">Multinomial Distribution</option>
                            <option value="uniform">Discrete Uniform Distribution</option>
                        </optgroup>
                    </select>
                </div>

                <div class="data-input-section">
                    <h3>📊 Data Input & Analysis</h3>
                    <div class="data-input-controls">
                        <div class="input-method-selector">
                            <label for="dataMethodSelect">Data Source:</label>
                            <select id="dataMethodSelect" onchange="changeDataMethod()">
                                <option value="upload">📁 Upload CSV/Excel</option>
                                <option value="random">🎲 Generate Random</option>
                                <option value="manual">✏️ Manual Entry</option>
                            </select>
                        </div>

                        <div id="uploadControls" style="display: block;">
                            <div class="param-control">
                                <label>Upload Data File:</label>
                                <input type="file" id="fileInput" accept=".csv,.xlsx,.xls,.txt"
                                       onchange="handleFileUpload(event)" style="margin: 5px 0;">
                            </div>
                            <div class="param-control">
                                <label for="columnSelect">Column:</label>
                                <select id="columnSelect"></select>
                            </div>
                            <button onclick="processUploadedData()" class="btn" style="margin-top: 5px;">Process Data</button>
                        </div>

                        <div id="randomControls" style="display: none;">
                            <div class="param-control">
                                <label for="sampleSize">Sample Size:</label>
                                <input type="number" id="sampleSize" value="100" min="10" max="10000" step="10">
                            </div>
                            <button onclick="generateRandomData()" class="btn" style="margin-top: 5px;">Generate</button>
                        </div>

                        <div id="manualControls" style="display: none;">
                            <div class="param-control">
                                <label>Data (comma-separated):</label>
                                <textarea id="manualDataInput" rows="3" placeholder="1.2, 3.4, 2.1, 5.6..."
                                          style="width: 100%; margin: 5px 0;"></textarea>
                            </div>
                            <button onclick="processManualData()" class="btn" style="margin-top: 5px;">Process</button>
                        </div>
                    </div>
                </div>

                <div class="content-grid">
                    <div class="params-panel">
                        <h3>Distribution Parameters</h3>
                        <div id="paramsContainer">
                            <div class="loading">Loading distribution parameters...</div>
                        </div>
                    </div>

                    <div class="stats-panel">
                        <h3>Data Analysis Results</h3>
                        <div class="stats-grid" id="dataAnalysisResults">
                            <div class="stat-card">
                                <div class="value">--</div>
                                <div class="label">Data Points</div>
                            </div>
                            <div class="stat-card">
                                <div class="value">--</div>
                                <div class="label">Sample Mean</div>
                            </div>
                            <div class="stat-card">
                                <div class="value">--</div>
                                <div class="label">Sample Std Dev</div>
                            </div>
                            <div class="stat-card">
                                <div class="value">--</div>
                                <div class="label">Skewness</div>
                            </div>
                            <div class="stat-card">
                                <div class="value">--</div>
                                <div class="label">KS Statistic</div>
                            </div>
                            <div class="stat-card">
                                <div class="value">--</div>
                                <div class="label">KS P-Value</div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="stats-panel">
                    <h3>Statistical Properties</h3>
                    <div class="stats-grid" id="statsContainer">
                        <div class="loading">Loading distribution statistics...</div>
                    </div>
                </div>

                <div class="stats-panel">
                    <h3>Distribution Fitting</h3>
                    <div id="fittingResults">
                        <p style="color: #666; margin: 0;">Upload data to see fitted parameters and goodness-of-fit results.</p>
                    </div>
                </div>
            </div>

            <div id="dataanalysis" class="tab-panel">
                <div class="content-grid">
                    <div class="params-panel">
                        <h3>Data Input Methods</h3>
                        <div class="param-control">
                            <label for="dataMethodSelect">Choose Data Source:</label>
                            <select id="dataMethodSelect" onchange="changeDataMethod()">
                                <option value="upload">📁 Upload CSV/Excel File</option>
                                <option value="random">🎲 Generate Random Sample</option>
                                <option value="manual">✏️ Manual Data Entry</option>
                            </select>
                        </div>

                        <div id="uploadControls" style="display: block;">
                            <label>Upload Data File:</label>
                            <input type="file" id="fileInput" accept=".csv,.xlsx,.xls,.txt"
                                   onchange="handleFileUpload(event)" style="margin: 10px 0;">
                            <div class="param-control">
                                <label for="columnSelect">Select Column:</label>
                                <select id="columnSelect"></select>
                            </div>
                            <button onclick="processUploadedData()" class="btn" style="margin-top: 10px;">Process Data</button>
                        </div>

                        <div id="randomControls" style="display: none;">
                            <div class="param-control">
                                <label for="sampleSize">Sample Size:</label>
                                <input type="number" id="sampleSize" value="100" min="10" max="10000" step="10">
                            </div>
                            <button onclick="generateRandomData()" class="btn" style="margin-top: 10px;">Generate Data</button>
                        </div>

                        <div id="manualControls" style="display: none;">
                            <label>Enter Data (comma-separated):</label>
                            <textarea id="manualDataInput" rows="4" placeholder="1.2, 3.4, 2.1, 5.6, ..."
                                      style="width: 100%; margin: 10px 0; padding: 8px;"></textarea>
                            <button onclick="processManualData()" class="btn" style="margin-top: 10px;">Process Data</button>
                        </div>
                    </div>

                    <div class="charts-panel">
                        <div class="chart-container">
                            <h4>Data Histogram & Distribution Fit</h4>
                            <canvas id="dataChart"></canvas>
                        </div>
                    </div>
                </div>

                <div class="stats-panel">
                    <h3>Data Analysis Results</h3>
                    <div class="stats-grid" id="dataAnalysisResults">
                        <div class="stat-card">
                            <div class="value">--</div>
                            <div class="label">Data Points</div>
                        </div>
                        <div class="stat-card">
                            <div class="value">--</div>
                            <div class="label">Mean</div>
                        </div>
                        <div class="stat-card">
                            <div class="value">--</div>
                            <div class="label">Std Dev</div>
                        </div>
                        <div class="stat-card">
                            <div class="value">--</div>
                            <div class="label">Skewness</div>
                        </div>
                        <div class="stat-card">
                            <div class="value">--</div>
                            <div class="label">KS Statistic</div>
                        </div>
                        <div class="stat-card">
                            <div class="value">--</div>
                            <div class="label">KS P-Value</div>
                        </div>
                    </div>
                </div>

                <div class="stats-panel">
                    <h3>Distribution Fitting Results</h3>
                    <div id="fittingResults"></div>
                </div>
            </div>

            <div id="visualizations" class="tab-panel">
                <div class="charts-panel">
                    <div class="chart-container">
                        <h4>Probability Density Function (PDF)</h4>
                        <canvas id="pdfChart"></canvas>
                    </div>
                    <div class="chart-container">
                        <h4>Cumulative Distribution Function (CDF)</h4>
                        <canvas id="cdfChart"></canvas>
                    </div>
                </div>
            </div>

            <div id="explanations" class="tab-panel">
                <div class="explanation-panel">
                    <h3 id="distTitle">Select a Distribution</h3>
                    <div id="explanationContent">
                        <div class="loading">Loading explanation...</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let charts = {};
        let currentDistribution = null;

        // Distribution definitions with parameters and explanations
        const distributions = {
            normal: {
                name: "Normal Distribution",
                params: [
                    { name: "μ (mean)", id: "mu", default: 0, min: -10, max: 10, step: 0.1 },
                    { name: "σ (standard deviation)", id: "sigma", default: 1, min: 0.1, max: 5, step: 0.1 }
                ],
                explanation: `
                    <p>The Normal distribution, discovered by Carl Friedrich Gauss, is the cornerstone of statistical inference and the Central Limit Theorem. It describes phenomena where many small, independent random effects combine additively.</p>

                    <div class="formula">
                    f(x; μ, σ) = (1/(σ√(2π))) * exp(-((x-μ)²)/(2σ²))
                    </div>

                    <p><strong>Parameters:</strong></p>
                    <ul>
                        <li><strong>μ (mean)</strong>: Location parameter - determines the center/peak of the distribution</li>
                        <li><strong>σ (standard deviation)</strong>: Scale parameter - controls the spread/variance (σ > 0)</li>
                    </ul>

                    <div class="applications">
                    <p><strong>Applications & Examples:</strong></p>
                    <ul>
                        <li><strong>Measurement Science</strong>: Heights, weights, IQ scores, blood pressure</li>
                        <li><strong>Quality Control</strong>: Manufacturing tolerances, product specifications</li>
                        <li><strong>Finance</strong>: Stock returns (under log-normal assumptions), option pricing</li>
                        <li><strong>Natural Phenomena</strong>: Light intensity, particle velocities, astronomical measurements</li>
                        <li><strong>Psychometrics</strong>: Test scores, reaction times, cognitive abilities</li>
                    </ul>
                    </div>

                    <p><strong>Theoretical Properties:</strong></p>
                    <ul>
                        <li>Symmetric with mean = median = mode = μ</li>
                        <li>68-95-99.7 rule: 68% within 1σ, 95% within 1.96σ, 99.7% within 3σ</li>
                        <li>Inflection points at μ ± σ</li>
                        <li>Maximum entropy distribution for given mean and variance</li>
                        <li>Stable under addition (Central Limit Theorem)</li>
                    </ul>

                    <p><strong>Historical Context:</strong> First derived by Abraham de Moivre in 1733 for binomial approximations. Gauss proved its universal importance in the theory of errors.</p>
                `,
                pdf: (x, params) => {
                    const mu = params.mu, sigma = params.sigma;
                    return (1 / (sigma * Math.sqrt(2 * Math.PI))) * Math.exp(-Math.pow((x - mu), 2) / (2 * Math.pow(sigma, 2)));
                },
                cdf: (x, params) => {
                    // Using approximation for normal CDF
                    const mu = params.mu, sigma = params.sigma;
                    const z = (x - mu) / sigma;
                    return 0.5 * (1 + math.erf(z / Math.sqrt(2)));
                },
                stats: (params) => {
                    const mu = params.mu, sigma = params.sigma;
                    return {
                        mean: mu,
                        variance: sigma * sigma,
                        skewness: 0,
                        kurtosis: 0,
                        median: mu,
                        mode: mu
                    };
                }
            },

            binomial: {
                name: "Binomial Distribution",
                params: [
                    { name: "n (trials)", id: "n", default: 10, min: 1, max: 100, step: 1 },
                    { name: "p (success probability)", id: "p", default: 0.5, min: 0, max: 1, step: 0.01 }
                ],
                explanation: `
                    <p>The Binomial distribution was developed by Jacob Bernoulli and is one of the earliest distributions in probability theory. It models scenarios where we conduct a fixed number of independent trials, each having exactly two possible outcomes (success/failure).</p>

                    <div class="formula">
                    P(X = k) = C(n,k) × p^k × (1-p)^(n-k)
                    </div>

                    <div class="formula" style="margin-top: 10px;">
                    C(n,k) = n! / (k! × (n-k)!)
                    </div>

                    <p><strong>Parameters:</strong></p>
                    <ul>
                        <li><strong>n (number of trials)</strong>: Fixed sample size (must be a positive integer)</li>
                        <li><strong>p (success probability)</strong>: Probability of success on any single trial (0 ≤ p ≤ 1)</li>
                    </ul>

                    <div class="applications">
                    <p><strong>Applications & Examples:</strong></p>
                    <ul>
                        <li><strong>Clinical Trials</strong>: Number of patients who respond to a treatment</li>
                        <li><strong>Quality Assurance</strong>: Proportion of defective products in a batch</li>
                        <li><strong>Elections</strong>: Number of votes for a candidate in exit polls</li>
                        <li><strong>A/B Testing</strong>: Conversion rates in website optimization</li>
                        <li><strong>Risk Assessment</strong>: Number of claims in an insurance portfolio</li>
                        <li><strong>Biology</strong>: Number of males in a litter of fixed size</li>
                    </ul>
                    </div>

                    <p><strong>Theoretical Properties:</strong></p>
                    <ul>
                        <li>Mean = np, Variance = np(1-p)</li>
                        <li>Symmetric when p = 0.5, right-skewed when p < 0.5, left-skewed when p > 0.5</li>
                        <li>Maximum value is n (all successes), minimum is 0 (no successes)</li>
                        <li>Approaches Poisson distribution as n→∞ and p→0 (with λ = np fixed)</li>
                        <li>Approaches Normal distribution as n→∞ (Central Limit Theorem)</li>
                    </ul>

                    <p><strong>Theoretical Foundations:</strong> Based on Bernoulli trials with independence assumption. Each trial must be identical and the outcome probabilities must remain constant across trials.</p>

                    <p><strong>Assumptions:</strong> Fixed number of trials, independence between trials, constant success probability, only two possible outcomes per trial.</p>
                `,
                pmf: (k, params) => {
                    const n = params.n, p = params.p;
                    if (k < 0 || k > n) return 0;
                    return math.combinations(n, k) * Math.pow(p, k) * Math.pow(1-p, n-k);
                },
                cdf: (k, params) => {
                    let sum = 0;
                    for (let i = 0; i <= k; i++) {
                        sum += this.pmf(i, params);
                    }
                    return sum;
                },
                stats: (params) => {
                    const n = params.n, p = params.p;
                    return {
                        mean: n * p,
                        variance: n * p * (1 - p),
                        skewness: (1 - 2*p) / Math.sqrt(n * p * (1-p)),
                        kurtosis: (1 - 6*p*(1-p)) / (n * p * (1-p)),
                        median: Math.round(n * p),
                        mode: Math.round((n + 1) * p)
                    };
                }
            },

            poisson: {
                name: "Poisson Distribution",
                params: [
                    { name: "λ (rate parameter)", id: "lambda", default: 2, min: 0.1, max: 10, step: 0.1 }
                ],
                explanation: `
                    <p>The Poisson distribution models the number of events occurring in a fixed interval of time or space.</p>

                    <div class="formula">
                    P(X = k) = e^(-λ) * λ^k / k!
                    </div>

                    <p><strong>Parameters:</strong></p>
                    <ul>
                        <li><strong>λ (lambda)</strong>: Average rate of events (λ > 0)</li>
                    </ul>

                    <div class="applications">
                    <p><strong>Applications:</strong></p>
                    <ul>
                        <li>Number of customer arrivals per hour</li>
                        <li>Number of defects in a product</li>
                        <li>Number of phone calls received</li>
                        <li>Number of accidents at an intersection</li>
                        <li>Radioactive decay events</li>
                    </ul>
                    </div>

                    <p><strong>Properties:</strong> Discrete distribution. Mean = Variance = λ. Right-skewed for small λ, approaches normal as λ increases.</p>
                `,
                pmf: (k, params) => {
                    const lambda = params.lambda;
                    if (k < 0) return 0;
                    return Math.exp(-lambda) * Math.pow(lambda, k) / math.factorial(k);
                },
                cdf: (k, params) => {
                    let sum = 0;
                    for (let i = 0; i <= k; i++) {
                        sum += this.pmf(i, params);
                    }
                    return sum;
                },
                stats: (params) => {
                    const lambda = params.lambda;
                    return {
                        mean: lambda,
                        variance: lambda,
                        skewness: 1/Math.sqrt(lambda),
                        kurtosis: 1/lambda,
                        median: Math.round(lambda + 1/3 - 0.02/lambda),
                        mode: Math.floor(lambda)
                    };
                }
            },

            beta: {
                name: "Beta Distribution",
                params: [
                    { name: "α (shape parameter)", id: "alpha", default: 2, min: 0.1, max: 10, step: 0.1 },
                    { name: "β (shape parameter)", id: "beta", default: 2, min: 0.1, max: 10, step: 0.1 }
                ],
                explanation: `
                    <p>The Beta distribution models random variables whose values are constrained to a finite interval [0,1].</p>

                    <div class="formula">
                    f(x) = (x^(α-1) * (1-x)^(β-1)) / B(α,β)
                    </div>

                    <p><strong>Parameters:</strong></p>
                    <ul>
                        <li><strong>α (alpha)</strong>: Shape parameter (α > 0)</li>
                        <li><strong>β (beta)</strong>: Shape parameter (β > 0)</li>
                    </ul>

                    <div class="applications">
                    <p><strong>Applications:</strong></p>
                    <ul>
                        <li>Proportions and rates between 0 and 1</li>
                        <li>Bayesian statistics (conjugate prior for Bernoulli)</li>
                        <li>Time allocation between activities</li>
                        <li>Quality control (percentage defective)</li>
                        <li>Risk assessment models</li>
                    </ul>
                    </div>

                    <p><strong>Properties:</strong> Flexible shapes from uniform to U-shaped. Mean = α/(α+β), Variance = αβ/((α+β)²(α+β+1)).</p>
                `,
                pdf: (x, params) => {
                    if (x < 0 || x > 1) return 0;
                    const alpha = params.alpha, beta = params.beta;
                    return Math.pow(x, alpha-1) * Math.pow(1-x, beta-1) / math.beta(alpha, beta);
                },
                cdf: (x, params) => {
                    if (x <= 0) return 0;
                    if (x >= 1) return 1;
                    // Approximate using beta incomplete function
                    const alpha = params.alpha, beta = params.beta;
                    return math.betainc(x, alpha, beta);
                },
                stats: (params) => {
                    const alpha = params.alpha, beta = params.beta;
                    const total = alpha + beta;
                    return {
                        mean: alpha / total,
                        variance: (alpha * beta) / (total * total * (total + 1)),
                        skewness: (2 * (beta - alpha) * Math.sqrt(total + 1)) / ((total + 2) * Math.sqrt(alpha * beta)),
                        kurtosis: (6 * (alpha - beta) * (alpha - beta) * (total + 1) - alpha * beta * (total + 2)) / (alpha * beta * (total + 2) * (total + 3)),
                        median: (alpha - 1/3) / (total - 2/3), // approximation
                        mode: (alpha - 1) / (total - 2)
                    };
                }
            },

            gamma: {
                name: "Gamma Distribution",
                params: [
                    { name: "k (shape)", id: "k", default: 2, min: 0.1, max: 10, step: 0.1 },
                    { name: "θ (scale)", id: "theta", default: 1, min: 0.1, max: 5, step: 0.1 }
                ],
                explanation: `
                    <p>The Gamma distribution generalizes the exponential distribution and is used for positive continuous variables.</p>

                    <div class="formula">
                    f(x) = (x^(k-1) * e^(-x/θ)) / (θ^k * Γ(k))
                    </div>

                    <p><strong>Parameters:</strong></p>
                    <ul>
                        <li><strong>k (shape)</strong>: Shape parameter (k > 0)</li>
                        <li><strong>θ (scale)</strong>: Scale parameter (θ > 0)</li>
                    </ul>

                    <div class="applications">
                    <p><strong>Applications:</strong></p>
                    <ul>
                        <li>Waiting times between Poisson events</li>
                        <li>Life testing and reliability engineering</li>
                        <li>Size of insurance claims</li>
                        <li>Queueing theory</li>
                        <li>Bayesian statistics (conjugate prior)</li>
                    </ul>
                    </div>

                    <p><strong>Properties:</strong> Right-skewed for small k, approaches normal as k increases. Mean = kθ, Variance = kθ².</p>
                `,
                pdf: (x, params) => {
                    if (x < 0) return 0;
                    const k = params.k, theta = params.theta;
                    return Math.pow(x, k-1) * Math.exp(-x/theta) / (Math.pow(theta, k) * math.gamma(k));
                },
                cdf: (x, params) => {
                    if (x <= 0) return 0;
                    const k = params.k, theta = params.theta;
                    return math.gammainc(k, x/theta);
                },
                stats: (params) => {
                    const k = params.k, theta = params.theta;
                    return {
                        mean: k * theta,
                        variance: k * theta * theta,
                        skewness: 2 / Math.sqrt(k),
                        kurtosis: 6 / k,
                        median: theta * (k - 1/3), // approximation
                        mode: theta * (k - 1)
                    };
                }
            },

            geometric: {
                name: "Geometric Distribution",
                params: [
                    { name: "p (success probability)", id: "p", default: 0.3, min: 0.01, max: 0.99, step: 0.01 }
                ],
                explanation: `
                    <p>The Geometric distribution models the number of trials needed to get the first success in Bernoulli trials.</p>

                    <div class="formula">
                    P(X = k) = (1-p)^(k-1) * p
                    </div>

                    <p><strong>Parameters:</strong></p>
                    <ul>
                        <li><strong>p</strong>: Probability of success in each trial (0 < p ≤ 1)</li>
                    </ul>

                    <div class="applications">
                    <p><strong>Applications:</strong></p>
                    <ul>
                        <li>Number of attempts needed to succeed</li>
                        <li>Reliability engineering (time to first failure)</li>
                        <li>Customer service (calls until first success)</li>
                        <li>Quality control (items inspected until first defect)</li>
                    </ul>
                    </div>

                    <p><strong>Properties:</strong> Memoryless property (like exponential distribution). Mean = 1/p, Variance = (1-p)/p².</p>
                `,
                pmf: (k, params) => {
                    const p = params.p;
                    if (k < 1) return 0;
                    return Math.pow(1-p, k-1) * p;
                },
                cdf: (k, params) => {
                    const p = params.p;
                    if (k < 1) return 0;
                    return 1 - Math.pow(1-p, k);
                },
                stats: (params) => {
                    const p = params.p;
                    return {
                        mean: 1/p,
                        variance: (1-p)/(p*p),
                        skewness: (2-p)/Math.sqrt(1-p),
                        kurtosis: (p*p - 6*p + 6)/(1-p),
                        median: Math.ceil(-Math.log(2)/Math.log(1-p)),
                        mode: 1
                    };
                }
            },

            uniform: {
                name: "Continuous Uniform Distribution",
                params: [
                    { name: "a (min)", id: "a", default: 0, min: -10, max: 10, step: 0.1 },
                    { name: "b (max)", id: "b", default: 1, min: -10, max: 10, step: 0.1 }
                ],
                explanation: `
                    <p>The Continuous Uniform distribution has constant probability density over a finite interval.</p>

                    <div class="formula">
                    f(x) = 1/(b-a)  for a ≤ x ≤ b
                    </div>

                    <p><strong>Parameters:</strong></p>
                    <ul>
                        <li><strong>a</strong>: Minimum value</li>
                        <li><strong>b</strong>: Maximum value (b > a)</li>
                    </ul>

                    <div class="applications">
                    <p><strong>Applications:</strong></p>
                    <ul>
                        <li>Random number generation</li>
                        <li>Round-off errors</li>
                        <li>Physical measurements with limited precision</li>
                        <li>Simulation modeling</li>
                        <li>Bayesian prior (lack of information)</li>
                    </ul>
                    </div>

                    <p><strong>Properties:</strong> Rectangular shape. Mean = (a+b)/2, Variance = (b-a)²/12. No mode (every value equally likely).</p>
                `,
                pdf: (x, params) => {
                    const a = params.a, b = params.b;
                    if (x < a || x > b) return 0;
                    return 1/(b-a);
                },
                cdf: (x, params) => {
                    const a = params.a, b = params.b;
                    if (x <= a) return 0;
                    if (x >= b) return 1;
                    return (x - a)/(b - a);
                },
                stats: (params) => {
                    const a = params.a, b = params.b;
                    const range = b - a;
                    return {
                        mean: (a + b) / 2,
                        variance: range * range / 12,
                        skewness: 0,
                        kurtosis: -6/5,
                        median: (a + b) / 2,
                        mode: 'No unique mode (uniform)'
                    };
                }
            },

            studentt: {
                name: "Student-t Distribution",
                params: [
                    { name: "ν (degrees of freedom)", id: "df", default: 5, min: 0.1, max: 30, step: 0.1 }
                ],
                explanation: `
                    <p>The Student-t distribution arises from estimating the mean of a normally distributed population with unknown variance.</p>

                    <div class="formula">
                    f(x) = Γ((ν+1)/2) / (√(νπ) * Γ(ν/2)) * (1 + x²/ν)^(-(ν+1)/2)
                    </div>

                    <p><strong>Parameters:</strong></p>
                    <ul>
                        <li><strong>ν (degrees of freedom)</strong>: Shape parameter (ν > 0)</li>
                    </ul>

                    <div class="applications">
                    <p><strong>Applications:</strong></p>
                    <ul>
                        <li>Statistical inference (t-tests)</li>
                        <li>Confidence intervals with small samples</li>
                        <li>Regression analysis</li>
                        <li>Bayesian statistics</li>
                        <li>Financial modeling (heavy tails)</li>
                    </ul>
                    </div>

                    <p><strong>Properties:</strong> Symmetric, bell-shaped but with heavier tails than normal. As ν→∞, approaches normal distribution. Mean = 0 for ν > 1, undefined otherwise.</p>
                `,
                pdf: (x, params) => {
                    const df = params.df;
                    const num = math.gamma((df + 1)/2);
                    const den = Math.sqrt(df * Math.PI) * math.gamma(df/2);
                    const factor = Math.pow(1 + x*x/df, -(df+1)/2);
                    return (num / den) * factor;
                },
                cdf: (x, params) => {
                    // Approximation for t-distribution CDF
                    const df = params.df;
                    if (df <= 0) return 0.5;

                    const z = x / Math.sqrt(1 + x*x/df);
                    const normal_cdf = 0.5 * (1 + math.erf(z/Math.sqrt(2)));
                    return normal_cdf;
                },
                stats: (params) => {
                    const df = params.df;
                    return {
                        mean: df > 1 ? 0 : 'Undefined',
                        variance: df > 2 ? df/(df-2) : 'Undefined',
                        skewness: df > 3 ? 0 : 'Undefined',
                        kurtosis: df > 4 ? 6/(df-4) : 'Undefined',
                        median: 0,
                        mode: 0
                    };
                }
            }
        };

        function showTab(tabName) {
            document.querySelectorAll('.tab-panel').forEach(panel => {
                panel.classList.remove('active');
            });

            document.querySelectorAll('.nav-tabs button').forEach(btn => {
                btn.classList.remove('active');
            });

            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');
        }

        function loadDistribution() {
            const select = document.getElementById('distributionSelect');
            const distName = select.value;

            if (!distName) return;

            currentDistribution = distributions[distName];
            document.getElementById('distTitle').textContent = currentDistribution.name;
            renderParameters();
            updateStatistics();
            renderCharts();
            renderExplanation();
        }

        function renderParameters() {
            const container = document.getElementById('paramsContainer');
            container.innerHTML = '';

            currentDistribution.params.forEach(param => {
                const control = document.createElement('div');
                control.className = 'param-control';
                control.innerHTML = `
                    <label for="${param.id}">${param.name}</label>
                    <input type="number" id="${param.id}" value="${param.default}"
                           min="${param.min}" max="${param.max}" step="${param.step}"
                           oninput="updateStatistics(); renderCharts()">
                `;
                container.appendChild(control);
            });
        }

        function getCurrentParams() {
            const params = {};
            if (!currentDistribution) return params;

            currentDistribution.params.forEach(param => {
                const input = document.getElementById(param.id);
                params[param.id] = parseFloat(input ? input.value : param.default) || param.default;
            });
            return params;
        }

        function updateStatistics() {
            if (!currentDistribution) return;

            const params = getCurrentParams();
            try {
                const stats = currentDistribution.stats(params);

                const container = document.getElementById('statsContainer');
                container.innerHTML = `
                    <div class="stat-card">
                        <div class="value">${stats.mean.toFixed ? stats.mean.toFixed(3) : stats.mean}</div>
                        <div class="label">Mean (μ)</div>
                    </div>
                    <div class="stat-card">
                        <div class="value">${stats.variance.toFixed ? stats.variance.toFixed(3) : stats.variance}</div>
                        <div class="label">Variance (σ²)</div>
                    </div>
                    <div class="stat-card">
                        <div class="value">${stats.skewness.toFixed ? stats.skewness.toFixed(3) : stats.skewness}</div>
                        <div class="label">Skewness</div>
                    </div>
                    <div class="stat-card">
                        <div class="value">${stats.kurtosis.toFixed ? stats.kurtosis.toFixed(3) : stats.kurtosis}</div>
                        <div class="label">Kurtosis</div>
                    </div>
                    <div class="stat-card">
                        <div class="value">${stats.median.toFixed ? stats.median.toFixed(3) : stats.median}</div>
                        <div class="label">Median</div>
                    </div>
                    <div class="stat-card">
                        <div class="value">${stats.mode.toFixed ? stats.mode.toFixed(3) : stats.mode}</div>
                        <div class="label">Mode</div>
                    </div>
                `;
            } catch (e) {
                console.error('Error calculating statistics:', e);
                document.getElementById('statsContainer').innerHTML = '<div class="error">Error calculating statistics</div>';
            }
        }

        function renderCharts() {
            if (!currentDistribution) return;

            const params = getCurrentParams();
            let xMin, xMax, step;

            if (currentDistribution.name.includes('Binomial') || currentDistribution.name.includes('Poisson') || currentDistribution.name.includes('Geometric')) {
                xMin = 0;
                xMax = currentDistribution.name.includes('Binomial') ? params.n : (currentDistribution.name.includes('Geometric') ? Math.min(params.lambda * 3, 20) : params.lambda * 3);
                step = 1;
            } else if (currentDistribution.name.includes('Beta') || currentDistribution.name.includes('Uniform')) {
                xMin = currentDistribution.name.includes('Uniform') ? params.a : 0;
                xMax = currentDistribution.name.includes('Uniform') ? params.b : 1;
                step = currentDistribution.name.includes('Beta') ? 0.01 : 0.1;
            } else {
                xMin = -5;
                xMax = 5;
                step = 0.1;
            }

            const xValues = [];
            const pdfValues = [];
            const cdfValues = [];

            try {
                for (let x = xMin; x <= xMax; x += step) {
                    xValues.push(x);
                    const roundedX = Math.round(x);

                    if (currentDistribution.name.includes('Binomial') || currentDistribution.name.includes('Poisson') || currentDistribution.name.includes('Geometric')) {
                        pdfValues.push(roundedX === x ? currentDistribution.pmf(x, params) : 0);
                        cdfValues.push(roundedX === x ? currentDistribution.cdf(x, params) : 0);
                    } else {
                        pdfValues.push(currentDistribution.pdf(x, params));
                        cdfValues.push(currentDistribution.cdf(x, params));
                    }
                }

                // PDF Chart
                const pdfCtx = document.getElementById('pdfChart').getContext('2d');
                if (charts.pdf) charts.pdf.destroy();
                charts.pdf = new Chart(pdfCtx, {
                    type: 'line',
                    data: {
                        labels: xValues,
                        datasets: [{
                            label: 'PDF',
                            data: pdfValues,
                            borderColor: '#007bff',
                            backgroundColor: 'rgba(0, 123, 255, 0.1)',
                            fill: true,
                            pointRadius: (currentDistribution.name.includes('Binomial') || currentDistribution.name.includes('Poisson') || currentDistribution.name.includes('Geometric')) ? 3 : 0
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            x: { title: { display: true, text: 'x' } },
                            y: { title: { display: true, text: 'Density' } }
                        },
                        plugins: {
                            title: { display: true, text: 'Probability Density Function' }
                        }
                    }
                });

                // CDF Chart
                const cdfCtx = document.getElementById('cdfChart').getContext('2d');
                if (charts.cdf) charts.cdf.destroy();
                charts.cdf = new Chart(cdfCtx, {
                    type: 'line',
                    data: {
                        labels: xValues,
                        datasets: [{
                            label: 'CDF',
                            data: cdfValues,
                            borderColor: '#28a745',
                            backgroundColor: 'rgba(40, 167, 69, 0.1)',
                            fill: true,
                            pointRadius: (currentDistribution.name.includes('Binomial') || currentDistribution.name.includes('Poisson') || currentDistribution.name.includes('Geometric')) ? 3 : 0
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            x: { title: { display: true, text: 'x' } },
                            y: { title: { display: true, text: 'Probability' }, min: 0, max: 1 }
                        },
                        plugins: {
                            title: { display: true, text: 'Cumulative Distribution Function' }
                        }
                    }
                });
            } catch (e) {
                console.error('Error rendering charts:', e);
                document.getElementById('pdfChart').getContext('2d').clearRect(0, 0, 400, 300);
                document.getElementById('cdfChart').getContext('2d').clearRect(0, 0, 400, 300);
            }
        }

        function renderExplanation() {
            const container = document.getElementById('explanationContent');
            container.innerHTML = currentDistribution.explanation;
        }

        // Global variables for data analysis
        let currentData = [];
        let fittedParams = {};

        function changeDataMethod() {
            const method = document.getElementById('dataMethodSelect').value;

            // Hide all controls
            document.getElementById('uploadControls').style.display = 'none';
            document.getElementById('randomControls').style.display = 'none';
            document.getElementById('manualControls').style.display = 'none';

            // Show selected controls
            if (method === 'upload') {
                document.getElementById('uploadControls').style.display = 'block';
            } else if (method === 'random') {
                document.getElementById('randomControls').style.display = 'block';
            } else if (method === 'manual') {
                document.getElementById('manualControls').style.display = 'block';
            }
        }

        function handleFileUpload(event) {
            const file = event.target.files[0];
            if (!file) return;

            const fileType = file.name.split('.').pop().toLowerCase();

            if (fileType === 'csv' || fileType === 'txt') {
                parseCSVFile(file);
            } else if (fileType === 'xlsx' || fileType === 'xls') {
                parseExcelFile(file);
            } else {
                alert('Please upload a CSV, TXT, Excel (.xlsx/.xls), or plain text file.');
            }
        }

        function parseCSVFile(file) {
            Papa.parse(file, {
                header: true,
                dynamicTyping: true,
                complete: function(results) {
                    if (results.errors.length > 0) {
                        console.error('CSV parsing errors:', results.errors);
                        alert('Error parsing CSV file. Please check the format.');
                        return;
                    }

                    const columns = Object.keys(results.data[0] || {});
                    const columnSelect = document.getElementById('columnSelect');
                    columnSelect.innerHTML = '<option value="">Select a column...</option>';

                    columns.forEach(col => {
                        const option = document.createElement('option');
                        option.value = col;
                        option.textContent = col;
                        columnSelect.appendChild(option);
                    });

                    // Store parsed data globally
                    window.parsedData = results.data.filter(row =>
                        Object.values(row).some(val =>
                            typeof val === 'number' && !isNaN(val)
                        )
                    );

                    alert(`File parsed successfully! Found ${columns.length} columns and ${window.parsedData.length} rows with numeric data.`);
                },
                error: function(error) {
                    console.error('CSV parsing error:', error);
                    alert('Error parsing CSV file: ' + error.message);
                }
            });
        }

        function parseExcelFile(file) {
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = new Uint8Array(e.target.result);
                    const workbook = XLSX.read(data, { type: 'array' });

                    // Get first worksheet
                    const firstSheet = workbook.Sheets[workbook.SheetNames[0]];
                    const jsonData = XLSX.utils.sheet_to_json(firstSheet, {
                        header: 1,
                        defval: null
                    });

                    // Convert to object format with headers
                    if (jsonData.length === 0) {
                        alert('Excel file is empty.');
                        return;
                    }

                    const headers = jsonData[0];
                    const rows = jsonData.slice(1);

                    const objectData = rows.map(row => {
                        const obj = {};
                        headers.forEach((header, i) => {
                            obj[header] = row[i];
                        });
                        return obj;
                    });

                    // Store parsed data globally
                    window.parsedData = objectData;

                    const columnSelect = document.getElementById('columnSelect');
                    columnSelect.innerHTML = '<option value="">Select a column...</option>';

                    headers.forEach(header => {
                        const option = document.createElement('option');
                        option.value = header;
                        option.textContent = header;
                        columnSelect.appendChild(option);
                    });

                    alert(`Excel file parsed successfully! Found ${headers.length} columns and ${rows.length} rows.`);
                } catch (error) {
                    console.error('Excel parsing error:', error);
                    alert('Error parsing Excel file: ' + error.message);
                }
            };

            reader.readAsArrayBuffer(file);
        }

        function processUploadedData() {
            const columnName = document.getElementById('columnSelect').value;
            if (!columnName || !window.parsedData) {
                alert('Please select a column and ensure data is loaded.');
                return;
            }

            // Extract numeric data from selected column
            const rawData = window.parsedData
                .map(row => row[columnName])
                .filter(val => typeof val === 'number' && !isNaN(val));

            if (rawData.length === 0) {
                alert('No valid numeric data found in the selected column.');
                return;
            }

            currentData = rawData;
            analyzeData(currentData);
        }

        function generateRandomData() {
            if (!currentDistribution) {
                alert('Please select a distribution first.');
                return;
            }

            const sampleSize = parseInt(document.getElementById('sampleSize').value) || 100;
            const params = getCurrentParams();

            const randomData = [];

            if (currentDistribution.name === 'Normal Distribution') {
                for (let i = 0; i < sampleSize; i++) {
                    // Box-Muller transform for normal random numbers
                    const u1 = Math.random();
                    const u2 = Math.random();
                    const z = Math.sqrt(-2 * Math.log(u1)) * Math.cos(2 * Math.PI * u2);
                    randomData.push(params.mu + z * Math.sqrt(params.sigma));
                }
            } else if (currentDistribution.name === 'Binomial Distribution') {
                for (let i = 0; i < sampleSize; i++) {
                    let successes = 0;
                    for (let j = 0; j < params.n; j++) {
                        if (Math.random() < params.p) successes++;
                    }
                    randomData.push(successes);
                }
            } else if (currentDistribution.name === 'Poisson Distribution') {
                // Use inverse transform sampling
                for (let i = 0; i < sampleSize; i++) {
                    let k = 0;
                    let p = Math.exp(-params.lambda);
                    let cdf = p;

                    const u = Math.random();
                    while (u > cdf) {
                        k++;
                        p *= params.lambda / k;
                        cdf += p;
                    }
                    randomData.push(k);
                }
            } else if (currentDistribution.name === 'Beta Distribution') {
                for (let i = 0; i < sampleSize; i++) {
                    // Using acceptance-rejection or simple approximation
                    randomData.push(Math.random()); // Placeholder - would need proper beta sampling
                }
            } else {
                // Default: uniform distribution
                for (let i = 0; i < sampleSize; i++) {
                    randomData.push(Math.random());
                }
            }

            currentData = randomData;
            analyzeData(currentData);
        }

        function processManualData() {
            const manualText = document.getElementById('manualDataInput').value.trim();
            if (!manualText) {
                alert('Please enter some data.');
                return;
            }

            try {
                const values = manualText.split(',')
                    .map(s => s.trim())
                    .map(s => parseFloat(s))
                    .filter(n => !isNaN(n));

                if (values.length === 0) {
                    alert('No valid numeric values found.');
                    return;
                }

                currentData = values;
                analyzeData(currentData);
            } catch (error) {
                alert('Error parsing manual data: ' + error.message);
            }
        }

        function analyzeData(data) {
            if (data.length === 0) return;

            // Calculate basic statistics
            const mean = data.reduce((a, b) => a + b, 0) / data.length;
            const variance = data.reduce((a, b) => a + Math.pow(b - mean, 2), 0) / data.length;
            const stdDev = Math.sqrt(variance);
            const skewness = calculateSkewness(data, mean, stdDev);
            const median = calculateMedian(data);

            // Fit distribution and perform KS test
            fitDistribution(data, mean, stdDev);

            // Update results display
            updateDataAnalysisResults(data.length, mean, stdDev, skewness, median);

            // Render data chart
            renderDataChart(data);
        }

        function calculateSkewness(data, mean, stdDev) {
            const n = data.length;
            const skewness = data.reduce((sum, val) => sum + Math.pow((val - mean) / stdDev, 3), 0) / n;
            return skewness;
        }

        function calculateMedian(data) {
            const sorted = [...data].sort((a, b) => a - b);
            const mid = Math.floor(sorted.length / 2);
            return sorted.length % 2 === 0 ? (sorted[mid - 1] + sorted[mid]) / 2 : sorted[mid];
        }

        function fitDistribution(data, sampleMean, sampleStd) {
            if (!currentDistribution) return;

            fittedParams = {};

            if (currentDistribution.name === 'Normal Distribution') {
                // For normal, fitted parameters are sample mean and std dev
                fittedParams.mu = sampleMean;
                fittedParams.sigma = sampleStd;
            } else if (currentDistribution.name === 'Binomial Distribution') {
                // Fit binomial by estimating n and p from mean and variance
                // This is a simple approximation
                fittedParams.p = Math.min(0.99, Math.max(0.01, sampleMean / 20)); // Assume n=20 for demo
                fittedParams.n = 20;
            } else if (currentDistribution.name === 'Poisson Distribution') {
                // For Poisson, lambda = mean
                fittedParams.lambda = sampleMean;
            } else if (currentDistribution.name === 'Uniform Distribution') {
                // For uniform, fit to min/max
                const minVal = Math.min(...data);
                const maxVal = Math.max(...data);
                fittedParams.a = minVal;
                fittedParams.b = maxVal;
            } else {
                // Default fit (could be improved)
                fittedParams = getCurrentParams();
            }

            // Perform KS test
            performKSTest(data, fittedParams);

            // Display fitted parameters
            displayFittingResults();
        }

        function performKSTest(data, params) {
            if (!currentDistribution) return;

            // Sort data for empirical CDF
            const sortedData = [...data].sort((a, b) => a - b);

            let maxDifference = 0;

            // Calculate KS statistic
            sortedData.forEach((value, index) => {
                const empiricalCDF = (index + 0.5) / sortedData.length;

                let theoreticalCDF = 0;
                if (currentDistribution.name === 'Normal Distribution') {
                    const z = (value - params.mu) / Math.sqrt(params.sigma);
                    theoreticalCDF = 0.5 * (1 + math.erf(z / Math.sqrt(2)));
                } else if (currentDistribution.name === 'Uniform Distribution') {
                    theoreticalCDF = (value - params.a) / (params.b - params.a);
                    theoreticalCDF = Math.max(0, Math.min(1, theoreticalCDF));
                } else if (currentDistribution.name === 'Binomial Distribution') {
                    theoreticalCDF = currentDistribution.cdf(Math.round(value), params);
                } else if (currentDistribution.name === 'Poisson Distribution') {
                    theoreticalCDF = currentDistribution.cdf(Math.round(value), params);
                } else {
                    theoreticalCDF = 0.5; // Placeholder
                }

                const difference = Math.abs(empiricalCDF - theoreticalCDF);
                maxDifference = Math.max(maxDifference, difference);
            });

            // For demo purposes, we'll approximate the p-value
            // In practice, this would require looking up tables or using special functions
            let pValue = 0.5; // Placeholder - would need proper calculation
            if (maxDifference < 0.1) pValue = 0.8;
            else if (maxDifference < 0.2) pValue = 0.5;
            else if (maxDifference < 0.3) pValue = 0.2;
            else pValue = 0.05;

            window.ksResults = { statistic: maxDifference, pValue: pValue };
        }

        function updateDataAnalysisResults(count, mean, stdDev, skewness, median) {
            const kstest = window.ksResults || { statistic: '--', pValue: '--' };

            document.getElementById('dataAnalysisResults').innerHTML = `
                <div class="stat-card">
                    <div class="value">${count}</div>
                    <div class="label">Data Points</div>
                </div>
                <div class="stat-card">
                    <div class="value">${mean.toFixed(3)}</div>
                    <div class="label">Mean</div>
                </div>
                <div class="stat-card">
                    <div class="value">${stdDev.toFixed(3)}</div>
                    <div class="label">Std Dev</div>
                </div>
                <div class="stat-card">
                    <div class="value">${skewness.toFixed(3)}</div>
                    <div class="label">Skewness</div>
                </div>
                <div class="stat-card">
                    <div class="value">${kstest.statistic.toFixed ? kstest.statistic.toFixed(3) : kstest.statistic}</div>
                    <div class="label">KS Statistic</div>
                </div>
                <div class="stat-card">
                    <div class="value">${kstest.pValue.toFixed ? kstest.pValue.toFixed(3) : kstest.pValue}</div>
                    <div class="label">KS P-Value</div>
                </div>
            `;
        }

        function displayFittingResults() {
            const container = document.getElementById('fittingResults');

            let resultsHTML = '<h4>Fitted Parameters:</h4><ul>';

            Object.entries(fittedParams).forEach(([param, value]) => {
                resultsHTML += `<li><strong>${param}:</strong> ${value.toFixed ? value.toFixed(4) : value}</li>`;
            });

            resultsHTML += '</ul>';

            if (window.ksResults) {
                resultsHTML += `
                    <h4>Goodness-of-Fit (KS Test):</h4>
                    <ul>
                        <li><strong>KS Statistic:</strong> ${window.ksResults.statistic.toFixed(4)}</li>
                        <li><strong>P-Value:</strong> ${window.ksResults.pValue.toFixed(4)}</li>
                        <li><strong>Result:</strong> ${window.ksResults.pValue > 0.05 ? 'Good fit (p > 0.05)' : 'Poor fit (p ≤ 0.05)'}</li>
                    </ul>
                `;
            }

            container.innerHTML = resultsHTML;
        }

        function renderDataChart(data) {
            const ctx = document.getElementById('dataChart').getContext('2d');

            // Create histogram data
            const minVal = Math.min(...data);
            const maxVal = Math.max(...data);
            const binCount = Math.min(30, Math.ceil(Math.sqrt(data.length)));

            const binWidth = (maxVal - minVal) / binCount;
            const bins = Array(binCount).fill(0);

            data.forEach(value => {
                const binIndex = Math.min(binCount - 1, Math.floor((value - minVal) / binWidth));
                bins[binIndex]++;
            });

            const binLabels = [];
            for (let i = 0; i < binCount; i++) {
                const binStart = minVal + i * binWidth;
                const binEnd = binStart + binWidth;
                binLabels.push(`${binStart.toFixed(2)} - ${binEnd.toFixed(2)}`);
            }

            // Calculate PDF points for fitted distribution
            const pdfPoints = [];
            const step = (maxVal - minVal) / 100;
            for (let x = minVal; x <= maxVal; x += step) {
                let pdfValue = 0;
                if (currentDistribution && fittedParams) {
                    try {
                        if (currentDistribution.name === 'Normal Distribution') {
                            pdfValue = currentDistribution.pdf(x, fittedParams);
                        } else if (currentDistribution.name === 'Uniform Distribution') {
                            pdfValue = currentDistribution.pdf(x, fittedParams);
                        } else {
                            pdfValue = currentDistribution.pdf(x, fittedParams);
                        }
                        // Scale PDF to match histogram scale
                        pdfValue *= binWidth * data.length;
                    } catch (e) {
                        console.error('Error calculating PDF:', e);
                    }
                }
                pdfPoints.push(pdfValue);
            }

            const datasets = [{
                label: 'Histogram',
                data: bins,
                backgroundColor: 'rgba(54, 162, 235, 0.5)',
                borderColor: 'rgba(54, 162, 235, 1)',
                borderWidth: 1,
                type: 'bar'
            }];

            if (pdfPoints.some(p => p > 0)) {
                const pdfLabels = [];
                for (let i = 0; i < pdfPoints.length; i++) {
                    pdfLabels.push((minVal + i * step).toFixed(2));
                }

                datasets.push({
                    label: 'Fitted Distribution',
                    data: pdfPoints,
                    borderColor: 'rgba(255, 99, 132, 1)',
                    backgroundColor: 'rgba(255, 99, 132, 0.1)',
                    borderWidth: 2,
                    fill: false,
                    type: 'line',
                    pointRadius: 0
                });
            }

            if (charts.data) charts.data.destroy();
            charts.data = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: binLabels,
                    datasets: datasets
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: { display: true, text: 'Frequency' }
                        },
                        x: {
                            title: { display: true, text: 'Value Range' }
                        }
                    },
                    plugins: {
                        title: { display: true, text: 'Data Histogram & Distribution Fit' }
                    }
                }
            });
        }

        // Initialize first distribution
        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('distributionSelect').value = 'normal';
            loadDistribution();

            // Initialize data method selector
            changeDataMethod();
        });
    </script>
</body>
</html>
